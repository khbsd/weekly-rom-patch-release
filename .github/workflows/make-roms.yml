name: make release

on:
  workflow_call:

jobs:
  make-release:
    runs-on: ubuntu-latest
    env:
      # your github username
      BASE_AUTHOR: pret
      HACK_AUTHOR: khbsd

      # your gba filename
      BASE_ROM: pokeemerald
      HACK_ROM: pokeemerald_kaya

      # what your repo is named
      BASE_REPO: pokeemerald
      HACK_REPO: pokeemerald-expansion-kaya

    steps:
      - name: install binutils
        run: |
          sudo apt update
          sudo apt install -y binutils-arm-none-eabi gcc-arm-none-eabi libnewlib-arm-none-eabi libpng-dev python3

      - name: make agbcc
        run: |
          git clone https://github.com/pret/agbcc
          cd agbcc
          ./build.sh
          cd ..

      - name: make ${{ env.BASE_ROM }}
        run: |
          git clone https://github.com/${{ env.BASE_AUTHOR }}/${{ env.BASE_REPO }} ./${{ env.BASE_AUTHOR }}
          cd agbcc
          ./install.sh ../${{ env.BASE_AUTHOR }}
          cd ..

          cd ./${{ env.BASE_AUTHOR }}
          make -j
          cd ..

      - name: make ${{ env.HACK_ROM }}
        run: |
          git clone https://github.com/${{ env.HACK_AUTHOR }}/${{ env.HACK_REPO }} ./${{ env.HACK_AUTHOR }}
          cd ./${{ env.HACK_AUTHOR }}
          make -j
          cd ..

      - name: Upload ${{ env.BASE_ROM }}
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.BASE_ROM }}.gba
          path: ${{ env.BASE_AUTHOR }}/${{ env.BASE_ROM }}.gba
          retention-days: 1

      - name: Upload ${{ env.HACK_ROM }}
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.HACK_ROM }}.gba
          path: ${{ env.HACK_AUTHOR }}/${{ env.HACK_ROM }}.gba
          retention-days: 1

